# Playwright E2E 테스트 계획 (Phase 2: 인증/로그인 UI)

## 1. 테스트 환경 준비

- Playwright 설치 및 기본 설정
  - `npm install --save-dev playwright`
  - `npx playwright install`
  - 테스트용 환경변수(.env.e2e 등) 및 테스트용 Supabase 프로젝트(테스트 DB, 테스트용 allowed_emails) 준비
- 테스트 계정 준비
  - allowed_emails에 등록된 구글 테스트 계정(실제 구글 계정 필요)
  - allowed_emails에 등록되지 않은 구글 계정(실제 구글 계정 필요)

## 2. 주요 테스트 시나리오 설계

### A. 정상 로그인 플로우 (허용된 이메일)

1. 앱 접속 → 로그인 화면 노출 확인
2. "Google로 로그인" 버튼 클릭 → 구글 OAuth 창으로 이동
3. 테스트용 허용 이메일로 로그인 시도
4. 로그인 성공 후 대시보드 화면 노출 및 사용자 이메일 표시 확인
5. "로그아웃" 버튼 클릭 → 로그인 화면으로 복귀 확인

### B. 비허용 이메일 로그인 시도

1. 앱 접속 → 로그인 화면 노출 확인
2. "Google로 로그인" 버튼 클릭 → 구글 OAuth 창으로 이동
3. allowed_emails에 없는 구글 계정으로 로그인 시도
4. 로그인 실패(대시보드 진입 불가, 로그인 화면 유지 또는 에러 메시지 노출) 확인

### C. 세션 유지 및 만료

1. 로그인 후 새로고침 → 세션 유지 및 대시보드 노출 확인
2. 로그아웃 후 새로고침 → 로그인 화면 노출 확인

### D. UI 요소 및 접근성

1. 로그인 화면에 "Google로 로그인" 버튼 존재 확인
2. 로그인 후 사용자 이메일 및 "로그아웃" 버튼 존재 확인
3. 대시보드에 인증된 사용자만 접근 가능함을 확인

## 3. Playwright 테스트 구현 전략

- 테스트 파일 구조
  - `tests/auth.e2e.spec.ts` 등으로 분리
- 테스트 전후 데이터 클린업
  - 테스트 시작 전 allowed_emails 테이블에 테스트 계정 등록
  - 테스트 종료 후 allowed_emails에서 테스트 계정 삭제
- 구글 OAuth 자동화
  - Playwright의 `storageState` 기능을 활용해 구글 로그인 세션을 미리 저장하거나, 실제 브라우저 자동화로 구글 로그인 플로우를 처리
  - 필요시 구글 계정 로그인 자동화(2단계 인증 등) 대응
- 환경별 분리
  - 실제 운영 DB와 분리된 테스트용 Supabase 프로젝트 사용 권장

## 4. 결과 검증 및 리포트

- 각 시나리오별로 화면 전환, UI 요소, 세션 상태 등 핵심 결과를 assertion으로 검증
- 실패 시 스크린샷/로그 저장
- CI 연동 시 테스트 자동화 및 결과 리포트
